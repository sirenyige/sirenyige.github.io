---
title: 架构设计
date: 2021-04-07 00:10:53
categories:
- 架构设计
tags:
---

# 架构设计的目的

架构设计的主要目的是为了**解决软件系统复杂度带来的问题**。

<!-- more -->

## 一、高性能带来的复杂度

### 1.1 单机复杂度

### 1.2 集群的复杂度

## 二、高可用带来的复杂度

系统无中断地执行其功能的能力，代表系统的可用性程度，是进行系统设计时的准则之一。

> 高性能增加机器目的在于“扩展”处理性能；高可用增加机器目的在于“冗余”处理单元。

### 2.1 CAP 定理

**CAP定理**（CAP theorem），又被称作**布鲁尔定理**（Brewer's theorem），它指出对于一个分布式计算系统来说，不可能同时满足以下三点：

- 一致性（**C**onsistency） （等同于所有节点访问同一份最新的数据副本）
- 可用性（**A**vailability）（每次请求都能获取到非错的响应——但是不保证获取的数据为最新数据）
- 分区容错性（**P**artition tolerance）（以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择）

根据定理，分布式系统只能满足三项中的两项而不可能满足全部三项。

### 2.2 计算高可用

### 2.3 存储高可用

存储高可用的难点不在于如何备份数据，而在于如何减少或者规避数据不一致对业务造成的影响。

### 2.4 高可用状态决策

无论是计算高可用还是存储高可用，其**基础都是“状态决策”**，即系统需要能够判断当前的状态是正常还是异常，如果出现了异常就要采取行动来保证高可用。如果状态决策本身都是有错误或者有偏差的，那么后续的任何行动和处理无论多么完美也都没有意义和价值。

**通过冗余来实现的高可用系统，状态决策本质上就不可能做到完全正确。**

#### 2.4.1 独裁式

独裁式决策指的是存在一个独立的决策主体，我们姑且称它为“决策者”，负责收集信息然后进行决策；所有冗余的个体，我们姑且称它为“上报者”，都将状态信息发送给决策者。

**独裁式的决策方式不会出现决策混乱的问题，因为只有一个决策者，但当决策者本身故障时，整个系统就无法实现准确的状态决策。**

#### 2.4.2 协商式

协商式决策指的是两个独立的个体通过交流信息，然后根据规则进行决策，最常用的协商式决策就是主备决策。

协商式决策的架构不复杂，规则也不复杂，其难点在于，如果两者的信息交换出现问题（比如主备连接中断），此时状态决策应该怎么做。

#### 2.4.3 民主式

民主式决策指的是多个独立的个体通过投票的方式来进行状态决策。

民主式决策和协商式决策比较类似，其基础都是独立的个体之间交换信息，每个个体做出自己的决策，然后按照“多数取胜”的规则来确定最终的状态。

- 民主式决策比协商式决策要复杂得多
- 除民主式决策还有一个固有的缺陷：脑裂。根本原因是，原来统一的集群因为连接中断，造成了两个独立分隔的子集群，每个子集群单独进行选举，于是选出了 2 个主机，相当于人体有两个大脑了。

> 为了解决脑裂问题，民主式决策的系统一般都采用“投票节点数必须超过系统总节点数一半”规则来处理。

## 三、可扩展性带来的复杂度

可扩展性指系统为了应对将来需求变化而提供的一种扩展能力，当有新的需求出现时，系统不需要或者仅需要少量修改就可以支持，无须整个系统重构或者重建。

设计具备良好可扩展性的系统，有两个基本条件：**正确预测变化**、**完美封装变化**。

### 3.1 预测变化

### 3.2 应对变化

1. 将“变化”封装在一个“变化层”，将不变的部分封装在一个独立的“稳定层”。
2. 提炼出一个“抽象层”和一个“实现层”。

## 四、低成本、安全、规模带来的复杂度