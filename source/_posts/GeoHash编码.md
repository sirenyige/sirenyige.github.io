---
title: GeoHash编码
date: 2020-05-18 23:39:58
categories:
- 其他
tags:
- 其他
---

# GeoHash编码

在处理地理位置信息时，直接去匹配两个哪怕距离很近的gps坐标，很可能都匹配不上。gps坐标的匹配，不应该做精确匹配，应该做范围匹配。

将地理位置进行编码，在检索时能够更快的进行地理空间上的检索，找到距离相近的位置。

<!-- more -->

## 一、GeoHash原理

将二维的经纬度坐标点转换为一维的字符串，也就是编码，某一个字符串表示了某一个矩形区域，也就是说在这个矩形区域中的所有经纬度点都共享一套编码也就是字符串。

GeoHash算法，其实质其实是二分法。不断地将地球的经度、纬度范围，进行**二分**，输出1/0比特，**偶数位放经度，奇数位放纬度**，把2串编码组合生成新串形成一串二进制码（二分的次数越多，输出的bit串越长），然后将这一串二进制码，按照5bit一组进行**base32编码**，得到最终结果。

## 二、GeoHash编码精度

| **geohash长度** | **Lat位数** | **Lng位数** | **Lat误差** | **Lng误差** | **km误差** |
| :-------------- | ----------- | ----------- | ----------- | ----------- | ---------- |
| 1               | 2           | 3           | ±23         | ±23         | ±2500      |
| 2               | 5           | 5           | ± 2.8       | ±5.6        | ±630       |
| 3               | 7           | 8           | ± 0.70      | ± 0.7       | ±78        |
| 4               | 10          | 10          | ± 0.087     | ± 0.18      | ±20        |
| 5               | 12          | 13          | ± 0.022     | ± 0.022     | ±2.4       |
| 6               | 15          | 15          | ± 0.0027    | ± 0.0055    | ±0.61      |
| 7               | 17          | 18          | ±0.00068    | ±0.00068    | ±0.076     |
| 8               | 20          | 20          | ±0.000086   | ±0.000172   | ±0.01911   |
| 9               | 22          | 23          | ±0.000021   | ±0.000021   | ±0.00478   |
| 10              | 25          | 25          | ±0.00000268 | ±0.00000536 | ±0.0005971 |
| 11              | 27          | 28          | ±0.00000067 | ±0.00000067 | ±0.0001492 |
| 12              | 30          | 30          | ±0.00000008 | ±0.00000017 | ±0.0000186 |

## 三、使用注意

1、 由于GeoHash是将区域划分为一个个规则矩形，并对每个矩形进行编码，这样在查询附近POI信息时会导致以下问题，比如红色的点是我们的位置，绿色的两个点分别是附近的两个餐馆，但是在查询的时候会发现距离较远餐馆的GeoHash编码与我们一样（因为在同一个GeoHash区域块上），而较近餐馆的GeoHash编码与我们不一致。这个问题往往产生在边界处。

<img src="/GeoHash编码/geohash.png" alt="geohash" style="zoom:150%;" />

解决的思路很简单，我们查询时，除了使用定位点的GeoHash编码进行匹配外，还使用周围8个区域的GeoHash编码，这样可以避免这个问题。 

2、GeoHash算法使用的是Peano空间填充曲线，会产生突变，造成了编码虽然相似但距离可能相差很大，因此在查询附近点时候，首先筛选GeoHash编码相似的点，然后进行实际距离计算。